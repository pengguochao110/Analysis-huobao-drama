# 用户故事

## 火宝短剧 (Huobao Drama) AI短剧生成平台

**版本**: v1.0  
**日期**: 2025-02-03  
**状态**: 草案  

---

## 1. 短剧管理用户故事

### US-DM-001 创建短剧项目

**用户故事**:
> As a 内容创作者, I want 创建新的短剧项目, So that 我可以开始制作新的短剧作品

**验收标准** (Given-When-Then格式):

**场景1: 成功创建项目**
```
Given 用户已登录系统
And 用户访问项目创建页面
When 用户填写项目标题为"都市爱情故事"
And 用户填写项目描述为"讲述年轻人在都市中的爱情与奋斗"
And 用户选择项目类型为"都市"
And 用户点击"创建"按钮
Then 系统应该创建新项目
And 项目状态应该为"草稿"
And 系统应该显示项目详情页面
And 系统应该记录创建时间为当前时间
```

**场景2: 标题为空验证**
```
Given 用户访问项目创建页面
When 用户不填写项目标题
And 用户点击"创建"按钮
Then 系统应该显示错误提示"标题不能为空"
And 系统不应该创建项目
```

**场景3: 标题过长验证**
```
Given 用户访问项目创建页面
When 用户填写项目标题超过100个字符
And 用户点击"创建"按钮
Then 系统应该显示错误提示"标题不能超过100个字符"
And 系统不应该创建项目
```

### US-DM-002 查看项目列表

**用户故事**:
> As a 内容创作者, I want 查看所有短剧项目的列表, So that 我可以快速找到需要编辑的项目

**验收标准**:

**场景1: 查看项目列表**
```
Given 用户已创建多个短剧项目
When 用户访问项目列表页面
Then 系统应该显示所有项目的列表
And 列表应该显示项目标题、类型、状态、更新时间
And 列表应该按更新时间倒序排列
And 每个项目应该显示剧集数量和总时长
```

**场景2: 按状态过滤**
```
Given 用户有多个不同状态的项目
When 用户选择状态过滤条件为"制作中"
Then 系统应该只显示状态为"制作中"的项目
And 项目数量应该实时更新
```

**场景3: 搜索项目**
```
Given 用户有多个项目
When 用户在搜索框输入"爱情"
Then 系统应该显示标题或描述包含"爱情"的项目
And 搜索结果应该高亮匹配的关键词
```

### US-DM-003 编辑短剧大纲

**用户故事**:
> As a 内容创作者, I want 编辑短剧的大纲和基本信息, So that 我可以完善短剧的创意构思

**验收标准**:

**场景1: 保存大纲**
```
Given 用户已进入项目编辑页面
When 用户修改项目标题为"新的标题"
And 用户填写项目简介
And 用户选择项目类型
And 用户添加标签["都市", "爱情", "励志"]
And 用户点击"保存"按钮
Then 系统应该保存所有修改
And 系统应该显示保存成功提示
And 项目更新时间应该更新为当前时间
```

**场景2: 自动保存草稿**
```
Given 用户正在编辑大纲
When 用户停止输入超过30秒
Then 系统应该自动保存当前内容
And 系统应该显示"已自动保存"提示
```

### US-DM-004 管理分集

**用户故事**:
> As a 内容创作者, I want 创建和管理短剧的多个剧集, So that 我可以组织长篇短剧的内容结构

**验收标准**:

**场景1: 添加剧集**
```
Given 用户正在管理项目分集
When 用户点击"添加剧集"按钮
Then 系统应该创建新的剧集
And 剧集编号应该自动递增
And 剧集标题应该默认为"第N集"
```

**场景2: 编辑剧本内容**
```
Given 用户正在编辑剧集
When 用户在剧本编辑器中输入剧本内容
And 用户点击"保存"按钮
Then 系统应该保存剧本内容
And 系统应该支持长文本存储（无字数限制）
```

**场景3: 删除剧集**
```
Given 用户有多集剧集
When 用户点击删除某集
And 用户确认删除操作
Then 系统应该删除该剧集
And 系统应该删除该剧集关联的所有分镜
And 后续剧集编号应该自动调整
```

---

## 2. 角色管理用户故事

### US-CM-001 创建角色

**用户故事**:
> As a 内容创作者, I want 为短剧创建角色, So that 我可以定义故事中的人物形象

**验收标准**:

**场景1: 创建角色**
```
Given 用户正在编辑项目角色
When 用户点击"添加角色"按钮
And 用户输入角色名称为"李明"
And 用户输入角色为"男主角"
And 用户输入角色描述
And 用户输入角色性格特征
And 用户输入角色外貌描述
And 用户点击"保存"按钮
Then 系统应该创建新角色
And 角色应该关联到当前项目
```

**场景2: 批量创建角色**
```
Given 用户有多个角色需要创建
When 用户点击"批量添加"按钮
And 用户在表格中输入多个角色信息
And 用户点击"保存所有"按钮
Then 系统应该创建所有角色
And 系统应该显示创建的角色数量
```

### US-CM-002 AI生成角色图像

**用户故事**:
> As a 内容创作者, I want 使用AI自动生成角色肖像, So that 我可以快速获得角色的视觉形象

**验收标准**:

**场景1: 生成角色图像**
```
Given 角色"李明"已创建并有外貌描述
And AI图像服务已配置
When 用户点击角色卡片上的"生成图像"按钮
Then 系统应该调用AI图像服务
And 系统应该显示生成进度
And 当生成完成时，系统应该显示生成的图像
And 系统应该保存图像到角色记录
```

**场景2: 重新生成图像**
```
Given 角色已有生成的图像
When 用户点击"重新生成"按钮
And 用户确认重新生成
Then 系统应该再次调用AI服务
And 系统应该保留历史生成记录
And 新图像应该替换旧图像作为角色主图
```

**场景3: 批量生成所有角色图像**
```
Given 项目有多个角色
When 用户点击"批量生成所有角色图像"按钮
Then 系统应该为每个角色创建生成任务
And 系统应该显示总体进度
And 系统应该允许查看每个角色的生成状态
And 生成失败的角色应该可以单独重试
```

### US-CM-003 从角色库选择角色

**用户故事**:
> As a 内容创作者, I want 从角色库中选择已有角色, So that 我可以复用之前创建的角色形象

**验收标准**:

**场景1: 浏览角色库**
```
Given 角色库中已有多个角色
When 用户点击"从角色库选择"按钮
Then 系统应该显示角色库列表
And 列表应该显示角色预览图、名称、分类
And 用户应该可以按分类过滤
And 用户应该可以搜索角色名称
```

**场景2: 应用角色到项目**
```
Given 用户正在浏览角色库
When 用户选择角色"都市白领"
And 用户点击"应用到项目"按钮
Then 系统应该将角色图像复制到当前项目
And 系统应该创建项目角色记录
And 系统应该关联角色库中的原始角色
```

### US-CM-004 管理角色关系

**用户故事**:
> As a 内容创作者, I want 管理角色与剧集的关联关系, So that 我可以追踪哪些角色出现在哪些剧集中

**验收标准**:

**场景1: 关联角色到剧集**
```
Given 用户正在编辑剧集
When 用户点击"管理角色"按钮
Then 系统应该显示项目所有角色列表
When 用户选择角色"李明"
And 用户点击"关联到本集"按钮
Then 系统应该建立角色与剧集的关联
And 角色应该显示在剧集角色列表中
```

**场景2: 查看角色出场剧集**
```
Given 角色已关联多个剧集
When 用户查看角色详情
Then 系统应该显示角色出场的所有剧集
And 系统应该显示角色在每集的戏份统计
```

---

## 3. 场景管理用户故事

### US-SM-001 创建场景

**用户故事**:
> As a 内容创作者, I want 创建拍摄场景, So that 我可以定义短剧的拍摄环境

**验收标准**:

**场景1: 创建基本场景**
```
Given 用户正在管理项目场景
When 用户点击"添加场景"按钮
And 用户输入地点为"咖啡厅"
And 用户输入时间为"傍晚"
And 用户输入场景描述
And 用户输入AI生成提示词
And 用户点击"保存"按钮
Then 系统应该创建新场景
And 场景应该关联到当前项目
```

**场景2: 创建场景并生成图像**
```
Given 用户正在创建场景
When 用户填写场景信息
And 用户点击"保存并生成图像"按钮
Then 系统应该保存场景
And 系统应该自动调用AI服务生成场景背景图
And 系统应该显示生成进度
```

### US-SM-002 管理场景图像

**用户故事**:
> As a 内容创作者, I want 为场景生成和管理背景图像, So that 我可以预览拍摄环境

**验收标准**:

**场景1: 生成场景图像**
```
Given 场景"咖啡厅"已创建
And 场景有AI提示词
When 用户点击"生成图像"按钮
Then 系统应该使用场景提示词调用AI服务
And 系统应该显示生成进度条
And 生成完成后，系统应该显示场景图像
And 图像应该自动保存并关联到场景
```

**场景2: 上传自定义场景图**
```
Given 用户有自定义场景图片
When 用户点击"上传图像"按钮
And 用户选择本地图片文件
Then 系统应该验证文件类型和大小
And 系统应该保存图片到存储
And 系统应该更新场景图像URL
```

---

## 4. 分镜管理用户故事

### US-SB-001 自动解析剧本分镜

**用户故事**:
> As a 内容创作者, I want 系统自动从剧本解析生成分镜, So that 我可以节省手动分解剧本的时间

**验收标准**:

**场景1: 解析剧本生成分镜**
```
Given 剧集已保存剧本内容
And AI文本服务已配置
When 用户点击"自动解析分镜"按钮
Then 系统应该显示确认对话框
When 用户确认解析
Then 系统应该调用AI服务解析剧本
And 系统应该显示解析进度
And 解析完成后，系统应该创建分镜列表
And 每个分镜应该包含场景、角色、动作、对话等信息
```

**场景2: 查看解析结果**
```
Given 剧本解析已完成
When 解析结果显示在页面上
Then 每个分镜应该显示：
  - 分镜编号
  - 场景信息
  - 出场角色
  - 镜头类型
  - 动作描述
  - 对话内容
And 用户应该可以编辑每个分镜的详细信息
```

**场景3: 重新解析**
```
Given 分镜已生成
When 用户修改剧本内容
And 用户点击"重新解析"按钮
Then 系统应该提示用户确认覆盖现有分镜
When 用户确认
Then 系统应该删除旧分镜
And 系统应该基于新剧本重新解析
```

### US-SB-002 手动创建分镜

**用户故事**:
> As a 内容创作者, I want 手动创建和编辑分镜, So that 我可以精确控制每个镜头的细节

**验收标准**:

**场景1: 创建分镜**
```
Given 用户正在查看剧集分镜
When 用户点击"添加分镜"按钮
Then 系统应该打开分镜编辑表单
When 用户填写分镜编号为"1"
And 用户选择场景为"咖啡厅"
And 用户选择出场角色
And 用户选择镜头类型为"中景"
And 用户填写动作描述
And 用户填写对话内容
And 用户点击"保存"按钮
Then 系统应该创建新分镜
And 分镜应该关联到当前剧集
```

**场景2: 编辑分镜**
```
Given 分镜已存在
When 用户点击分镜卡片上的"编辑"按钮
Then 系统应该打开分镜编辑表单
When 用户修改分镜信息
And 用户点击"保存"按钮
Then 系统应该更新分镜信息
And 系统应该显示保存成功提示
```

**场景3: 调整分镜顺序**
```
Given 有多个分镜
When 用户拖拽分镜卡片到新的位置
Then 系统应该重新排序分镜
And 分镜编号应该自动更新
```

### US-SB-003 关联道具到分镜

**用户故事**:
> As a 内容创作者, I want 将道具关联到分镜, So that 我可以追踪每个镜头需要的道具

**验收标准**:

**场景1: 添加道具到分镜**
```
Given 用户正在编辑分镜
When 用户点击"管理道具"按钮
Then 系统应该显示项目所有道具列表
When 用户选择道具"咖啡杯"
And 用户点击"添加到分镜"按钮
Then 系统应该建立道具与分镜的关联
And 道具应该显示在分镜的道具列表中
```

**场景2: 查看分镜道具清单**
```
Given 分镜已关联多个道具
When 用户查看分镜详情
Then 系统应该显示分镜的所有道具
And 每个道具应该显示图像和名称
```

### US-SB-004 管理帧提示词

**用户故事**:
> As a 内容创作者, I want 为分镜的不同帧创建提示词, So that 我可以控制图像生成的细节

**验收标准**:

**场景1: 创建首帧提示词**
```
Given 用户正在编辑分镜
When 用户点击"帧提示词"标签
And 用户选择"首帧"类型
And 用户输入提示词描述
And 用户点击"生成"按钮
Then 系统应该创建首帧提示词记录
And 系统应该基于分镜信息自动生成基础提示词
```

**场景2: 创建面板帧提示词**
```
Given 用户需要创建分镜面板
When 用户选择"面板"类型
And 用户选择布局为"水平3格"
And 用户输入每个格子的描述
And 用户点击"生成"按钮
Then 系统应该创建面板帧提示词
And 系统应该记录布局信息
```

---

## 5. 图像生成用户故事

### US-IG-001 提交图像生成任务

**用户故事**:
> As a 内容创作者, I want 提交图像生成请求并查看进度, So that 我可以获得AI生成的图像素材

**验收标准**:

**场景1: 生成分镜图像**
```
Given 分镜已创建并有关联的场景和角色
When 用户点击"生成分镜图"按钮
Then 系统应该组合场景和角色的提示词
And 系统应该创建图像生成任务
And 系统应该显示任务ID和初始状态"待处理"
And 系统应该显示实时进度
```

**场景2: 查看生成状态**
```
Given 图像生成任务已提交
When 用户查看任务状态
Then 系统应该显示：
  - 当前状态（待处理/处理中/完成/失败）
  - 进度百分比
  - 预计剩余时间
  - 错误信息（如失败）
```

**场景3: 重试失败的生成**
```
Given 图像生成任务失败
When 用户查看失败原因
And 用户点击"重试"按钮
Then 系统应该重新提交生成任务
And 系统应该保留失败记录供参考
```

### US-IG-002 批量生成剧集图像

**用户故事**:
> As a 内容创作者, I want 批量生成整个剧集的所有图像, So that 我可以提高效率一次性完成大量生成工作

**验收标准**:

**场景1: 启动批量生成**
```
Given 剧集有多个分镜
When 用户点击"批量生成所有图像"按钮
Then 系统应该显示确认对话框，列出将要生成的图像数量
When 用户确认
Then 系统应该创建批量任务
And 系统应该显示总体进度条
And 系统应该列出每个分镜的生成状态
```

**场景2: 监控批量任务**
```
Given 批量生成正在进行
When 用户查看批量任务进度
Then 系统应该显示：
  - 总体进度（已完成/总数）
  - 每个分镜的状态图标
  - 预计完成时间
  - 取消任务按钮
```

**场景3: 处理部分失败**
```
Given 批量生成部分分镜失败
When 批量任务完成
Then 系统应该标记失败的分镜
And 系统应该提供"仅重试失败项"按钮
And 成功的分镜应该显示生成的图像
```

### US-IG-003 管理生成的图像

**用户故事**:
> As a 内容创作者, I want 查看和管理所有生成的图像, So that 我可以选择最佳的图像使用

**验收标准**:

**场景1: 查看图像库**
```
Given 用户已生成多个图像
When 用户访问图像库页面
Then 系统应该显示所有生成的图像
And 图像应该按类型分组（角色/场景/分镜）
And 图像应该显示生成参数和状态
And 用户应该可以搜索和过滤图像
```

**场景2: 导入图像到资产库**
```
Given 图像生成已完成
When 用户点击"导入到资产库"按钮
Then 系统应该创建资产记录
And 系统应该复制图像到资产目录
And 系统应该显示导入成功提示
```

---

## 6. 视频生成用户故事

### US-VG-001 生成视频片段

**用户故事**:
> As a 视频制作人员, I want 从图像生成短视频片段, So that 我可以为分镜添加动态效果

**验收标准**:

**场景1: 图生视频**
```
Given 分镜已有生成的图像
When 用户点击"生成视频"按钮
Then 系统应该打开视频生成配置面板
When 用户设置视频参数：
  - 时长：5秒
  - 运动强度：中等
  - 相机运动：缓慢推进
And 用户点击"开始生成"按钮
Then 系统应该创建视频生成任务
And 系统应该调用AI视频服务
And 系统应该显示生成进度
```

**场景2: 配置视频参数**
```
Given 用户正在配置视频生成
When 用户调整参数滑块
Then 系统应该实时显示参数值
And 系统应该提供参数说明提示
And 系统应该显示预计积分消耗（如适用）
```

### US-VG-002 批量生成剧集视频

**用户故事**:
> As a 视频制作人员, I want 批量生成整个剧集的所有视频片段, So that 我可以快速完成视频制作

**验收标准**:

**场景1: 批量视频生成**
```
Given 剧集所有分镜已有图像
When 用户点击"批量生成所有视频"按钮
Then 系统应该检查所有分镜是否有图像
And 系统应该显示将要生成的视频数量
When 用户确认
Then 系统应该创建批量视频任务
And 系统应该依次处理每个分镜
And 系统应该显示实时进度
```

**场景2: 队列管理**
```
Given 多个批量任务在队列中
When 用户查看任务队列
Then 系统应该显示：
  - 当前正在处理的任务
  - 等待中的任务列表
  - 预计等待时间
  - 取消排队任务选项
```

---

## 7. 视频合成用户故事

### US-VM-001 合成完整剧集视频

**用户故事**:
> As a 视频制作人员, I want 将所有视频片段合成为完整的剧集视频, So that 我可以获得最终的成品视频

**验收标准**:

**场景1: 选择视频合并**
```
Given 剧集所有分镜已有视频
When 用户进入视频合成页面
Then 系统应该列出所有可合并的视频片段
And 系统应该按分镜顺序排列
When 用户选择要合并的视频
And 用户选择转场效果为"淡入淡出"
And 用户点击"开始合并"按钮
Then 系统应该创建合并任务
And 系统应该使用FFmpeg处理视频
```

**场景2: 配置转场效果**
```
Given 用户正在配置视频合并
When 用户点击"转场效果"下拉菜单
Then 系统应该显示可用的转场效果列表：
  - 淡入淡出
  - 划像
  - 溶解
  - 无效果
When 用户选择效果
Then 系统应该显示效果预览
```

**场景3: 查看合并进度**
```
Given 视频合并正在进行
When 用户查看合并状态
Then 系统应该显示：
  - 当前处理的分镜
  - 总体进度百分比
  - 预计剩余时间
  - FFmpeg处理日志
```

**场景4: 预览和下载成品**
```
Given 视频合并已完成
When 用户查看完成通知
Then 系统应该显示成品视频预览
And 系统应该提供下载按钮
And 系统应该显示视频信息（时长、分辨率、文件大小）
```

### US-VM-002 提取音频

**用户故事**:
> As a 视频制作人员, I want 从视频提取音频, So that 我可以单独处理音轨或制作配音

**验收标准**:

**场景1: 提取单个视频音频**
```
Given 用户有生成的视频文件
When 用户点击"提取音频"按钮
Then 系统应该使用FFmpeg提取音轨
And 系统应该保存音频文件
And 系统应该创建音频资产记录
And 系统应该提供音频预览和下载
```

**场景2: 批量提取音频**
```
Given 用户有多个视频文件
When 用户选择多个视频
And 用户点击"批量提取"按钮
Then 系统应该依次处理每个视频
And 系统应该显示处理进度
And 系统应该打包所有音频文件供下载
```

---

## 8. AI配置管理用户故事

### US-AI-001 配置AI服务

**用户故事**:
> As a 系统管理员, I want 配置多个AI服务提供商, So that 我可以根据需求选择不同的AI服务

**验收标准**:

**场景1: 添加新的AI配置**
```
Given 用户进入AI配置页面
When 用户点击"添加配置"按钮
Then 系统应该打开配置表单
When 用户选择服务类型为"图像生成"
And 用户选择提供商为"OpenAI"
And 用户输入配置名称
And 用户输入基础URL
And 用户输入API密钥
And 用户输入模型名称
And 用户点击"保存"按钮
Then 系统应该创建新配置
And 系统应该加密存储API密钥
```

**场景2: 测试AI连接**
```
Given 用户正在编辑AI配置
When 用户点击"测试连接"按钮
Then 系统应该调用AI服务健康检查
And 系统应该显示测试结果
When 连接成功
Then 系统应该显示"连接成功"提示
When 连接失败
Then 系统应该显示详细错误信息
```

**场景3: 设置默认配置**
```
Given 用户有多个AI配置
When 用户点击某个配置的"设为默认"按钮
Then 系统应该将该配置设为默认
And 系统应该取消其他配置的默认状态
And 新任务应该自动使用默认配置
```

### US-AI-002 管理多提供商

**用户故事**:
> As a 系统管理员, I want 管理多个AI提供商的配置, So that 我可以灵活切换和备份AI服务

**验收标准**:

**场景1: 切换提供商**
```
Given 系统已配置多个图像提供商
When 默认提供商服务异常
Then 系统应该自动切换到备用提供商
And 系统应该记录切换日志
```

**场景2: 配置优先级**
```
Given 用户有多个同类型配置
When 用户在配置列表中调整顺序
Then 系统应该更新配置优先级
And 高优先级配置应该优先被使用
```

---

## 9. 资产管理用户故事

### US-AM-001 查看资产库

**用户故事**:
> As a 内容创作者, I want 查看所有生成的媒体资产, So that 我可以管理和复用素材

**验收标准**:

**场景1: 浏览资产库**
```
Given 系统已生成多个图像和视频
When 用户访问资产库页面
Then 系统应该显示所有资产
And 资产应该按类型分组（图像/视频/音频）
And 资产应该显示缩略图和基本信息
And 用户应该可以按项目、剧集过滤
```

**场景2: 搜索资产**
```
Given 资产库有大量资产
When 用户在搜索框输入关键词
Then 系统应该搜索资产名称和描述
And 系统应该实时显示搜索结果
```

### US-AM-002 管理资产元数据

**用户故事**:
> As a 内容创作者, I want 编辑资产的信息和分类, So that 我可以更好地组织素材

**验收标准**:

**场景1: 编辑资产信息**
```
Given 用户正在查看资产库
When 用户点击资产卡片上的"编辑"按钮
Then 系统应该打开编辑表单
When 用户修改资产名称
And 用户添加描述
And 用户选择分类
And 用户点击"保存"按钮
Then 系统应该更新资产信息
```

**场景2: 收藏资产**
```
Given 用户浏览资产库
When 用户点击资产卡片上的星形图标
Then 系统应该标记资产为收藏
And 收藏资产应该在列表中置顶显示
```

---

## 10. 任务管理用户故事

### US-TM-001 监控异步任务

**用户故事**:
> As a 内容创作者, I want 查看所有正在运行的任务, So that 我可以了解系统处理状态

**验收标准**:

**场景1: 查看任务列表**
```
Given 系统有正在运行的任务
When 用户访问任务管理页面
Then 系统应该显示所有任务
And 任务应该按状态分组（进行中/已完成/失败）
And 每个任务应该显示：
  - 任务类型
  - 关联资源
  - 当前进度
  - 开始时间
  - 预计完成时间
```

**场景2: 取消任务**
```
Given 有正在进行的任务
When 用户点击任务上的"取消"按钮
Then 系统应该确认取消操作
When 用户确认
Then 系统应该停止任务处理
And 系统应该标记任务为已取消
```

**场景3: 查看任务详情**
```
Given 任务已完成或失败
When 用户点击任务查看详情
Then 系统应该显示：
  - 完整执行日志
  - 输入参数
  - 输出结果
  - 错误详情（如失败）
```

---

## 验收标准优先级汇总

| 优先级 | 用户故事数量 | 关键功能 |
|-------|-------------|---------|
| 高 | 15 | 项目创建、角色管理、AI生成、分镜解析 |
| 中 | 10 | 批量处理、资产库、任务监控、配置管理 |
| 低 | 5 | 高级设置、国际化、扩展功能 |

---

**文档结束**
