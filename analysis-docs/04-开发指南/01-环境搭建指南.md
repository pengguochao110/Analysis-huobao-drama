# 01-ç¯å¢ƒæ­å»ºæŒ‡å—

æœ¬æ–‡æ¡£æŒ‡å¯¼å¼€å‘è€…å®Œæˆç«å®çŸ­å‰§é¡¹ç›®çš„å¼€å‘ç¯å¢ƒæ­å»ºã€‚

---

## 1. å¼€å‘å·¥å…·å®‰è£…

### 1.1 Go 1.23+ å®‰è£…

**Windows:**
1. ä¸‹è½½ [Go 1.23+ Windows å®‰è£…åŒ…](https://go.dev/dl/)
2. è¿è¡Œå®‰è£…ç¨‹åºï¼ŒæŒ‰æç¤ºå®Œæˆå®‰è£…
3. éªŒè¯å®‰è£…ï¼š

```bash
go version
# åº”è¾“å‡º: go version go1.23.x windows/amd64
```

**macOS:**
```bash
# ä½¿ç”¨ Homebrew å®‰è£…
brew install go@1.23

# éªŒè¯
go version
```

**Linux (Ubuntu/Debian):**
```bash
# ä¸‹è½½å¹¶å®‰è£…
wget https://go.dev/dl/go1.23.4.linux-amd64.tar.gz
sudo rm -rf /usr/local/go
sudo tar -C /usr/local -xzf go1.23.4.linux-amd64.tar.gz

# æ·»åŠ ç¯å¢ƒå˜é‡
echo 'export PATH=$PATH:/usr/local/go/bin' >> ~/.bashrc
source ~/.bashrc

# éªŒè¯
go version
```

### 1.2 Node.js 18+ å’Œ pnpm å®‰è£…

**Windows:**
1. ä¸‹è½½ [Node.js 18+ LTS](https://nodejs.org/)
2. è¿è¡Œå®‰è£…ç¨‹åº
3. å®‰è£… pnpmï¼š

```bash
npm install -g pnpm

# éªŒè¯
node --version  # v18.x.x
pnpm --version  # 9.x.x
```

**macOS:**
```bash
# ä½¿ç”¨ Homebrew å®‰è£… Node.js
brew install node@18

# å®‰è£… pnpm
npm install -g pnpm

# éªŒè¯
node --version
pnpm --version
```

**Linux:**
```bash
# ä½¿ç”¨ NodeSource å®‰è£… Node.js 18
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# å®‰è£… pnpm
npm install -g pnpm

# éªŒè¯
node --version
pnpm --version
```

### 1.3 FFmpeg 4.0+ å®‰è£…å’ŒéªŒè¯

**macOS:**
```bash
brew install ffmpeg

# éªŒè¯å®‰è£…
ffmpeg -version
```

**Ubuntu/Debian:**
```bash
sudo apt update
sudo apt install ffmpeg

# éªŒè¯å®‰è£…
ffmpeg -version
```

**Windows:**
1. ä» [FFmpeg å®˜ç½‘](https://ffmpeg.org/download.html) ä¸‹è½½ Windows æ„å»ºç‰ˆæœ¬
2. è§£å‹åˆ° `C:\ffmpeg` ç›®å½•
3. æ·»åŠ ç¯å¢ƒå˜é‡ï¼š
   - æ‰“å¼€ã€Œç³»ç»Ÿå±æ€§ã€â†’ã€Œé«˜çº§ã€â†’ã€Œç¯å¢ƒå˜é‡ã€
   - ç¼–è¾‘ã€ŒPathã€å˜é‡ï¼Œæ·»åŠ  `C:\ffmpeg\bin`
4. é‡å¯ç»ˆç«¯ï¼ŒéªŒè¯å®‰è£…ï¼š

```bash
ffmpeg -version
```

### 1.4 Git å®‰è£…

**Windows:**
1. ä¸‹è½½ [Git for Windows](https://git-scm.com/download/win)
2. è¿è¡Œå®‰è£…ç¨‹åºï¼Œé€‰æ‹©é»˜è®¤é€‰é¡¹
3. éªŒè¯ï¼š

```bash
git --version
```

**macOS:**
```bash
# é€šå¸¸å·²é¢„è£…ï¼Œæˆ–å¯é€šè¿‡ Xcode Command Line Tools å®‰è£…
xcode-select --install

# æˆ–ä½¿ç”¨ Homebrew
brew install git
```

**Linux:**
```bash
sudo apt update
sudo apt install git

# éªŒè¯
git --version
```

---

## 2. IDEé…ç½®

### 2.1 VS Code æ¨èæ’ä»¶åˆ—è¡¨

**Go å¼€å‘æ’ä»¶ï¼š**
- `Go` (by Go Team at Google) - Go è¯­è¨€æ”¯æŒ
- `Go Test Explorer` - æµ‹è¯•è¿è¡Œå™¨
- `Go Outliner` - ä»£ç ç»“æ„è§†å›¾

**Vue/TypeScript å¼€å‘æ’ä»¶ï¼š**
- `Volar` (Vue Language Features) - Vue 3 å®˜æ–¹æ’ä»¶
- `TypeScript Vue Plugin` - TypeScript æ”¯æŒ
- `ESLint` - ä»£ç è§„èŒƒæ£€æŸ¥
- `Prettier` - ä»£ç æ ¼å¼åŒ–
- `Tailwind CSS IntelliSense` - Tailwind æ™ºèƒ½æç¤º

**é€šç”¨æ’ä»¶ï¼š**
- `EditorConfig` - ç»Ÿä¸€ç¼–è¾‘å™¨é…ç½®
- `GitLens` - Git å¢å¼ºåŠŸèƒ½
- `YAML` - YAML æ–‡ä»¶æ”¯æŒ
- `Markdown All in One` - Markdown æ”¯æŒ

### 2.2 VS Code settings.json é…ç½®ç¤ºä¾‹

```json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": "explicit"
  },
  
  "go.formatTool": "gofmt",
  "go.lintTool": "golangci-lint",
  "go.toolsManagement.autoUpdate": true,
  "go.useLanguageServer": true,
  "go.languageServerExperimentalWorkspaceModule": true,
  
  "typescript.tsdk": "./web/node_modules/typescript/lib",
  "typescript.enablePromptUseWorkspaceTsdk": true,
  
  "eslint.workingDirectories": ["./web"],
  "eslint.validate": [
    "javascript",
    "typescript",
    "vue"
  ],
  
  "tailwindCSS.includeLanguages": {
    "vue": "html"
  },
  "tailwindCSS.experimental.classRegex": [
    ["class="]([^"]*)"", "([^"]*)"],
    ["class="]([^']*)'", "([^']*)"]
  ]
}
```

### 2.3 launch.json è°ƒè¯•é…ç½®

**Go è°ƒè¯•é…ç½®ï¼š**

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Launch Go Backend",
      "type": "go",
      "request": "launch",
      "mode": "auto",
      "program": "${workspaceFolder}/main.go",
      "env": {
        "GIN_MODE": "debug"
      },
      "args": [],
      "showLog": true
    },
    {
      "name": "Debug Go Tests",
      "type": "go",
      "request": "launch",
      "mode": "test",
      "program": "${workspaceFolder}",
      "showLog": true
    }
  ]
}
```

**Vue å‰ç«¯è°ƒè¯•é…ç½®ï¼š**

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Debug Vue Frontend",
      "type": "chrome",
      "request": "launch",
      "url": "http://localhost:3012",
      "webRoot": "${workspaceFolder}/web",
      "sourceMapPathOverrides": {
        "webpack:///src/*": "${webRoot}/src/*"
      }
    }
  ]
}
```

### 2.4 Goland/IntelliJ IDEA é…ç½®

**æ’ä»¶å®‰è£…ï¼š**
1. æ‰“å¼€ `File` â†’ `Settings` â†’ `Plugins`
2. å®‰è£…ä»¥ä¸‹æ’ä»¶ï¼š
   - Go (GoLand å·²å†…ç½®)
   - Vue.js (IntelliJ IDEA éœ€è¦å®‰è£…)
   - Tailwind CSS
   - .env files support

**Go é…ç½®ï¼š**
1. `File` â†’ `Settings` â†’ `Languages & Frameworks` â†’ `Go` â†’ `GOPATH`
2. ç¡®ä¿ Go SDK å·²æ­£ç¡®é…ç½®
3. å¯ç”¨ `Enable Go modules integration`

**ä»£ç é£æ ¼ï¼š**
1. `File` â†’ `Settings` â†’ `Editor` â†’ `Code Style` â†’ `Go`
2. è®¾ç½®ï¼š
   - ä½¿ç”¨ `gofmt` æ ¼å¼åŒ–
   - Tab å¤§å°ï¼š4
   - ç¼©è¿›ï¼š4 ä¸ªç©ºæ ¼

---

## 3. é¡¹ç›®åˆå§‹åŒ–å’Œä¾èµ–å®‰è£…

### 3.1 å…‹éš†é¡¹ç›®

```bash
# ä½¿ç”¨ HTTPS
git clone https://github.com/chatfire-AI/huobao-drama.git

# æˆ–ä½¿ç”¨ SSH
git clone git@github.com:chatfire-AI/huobao-drama.git

# è¿›å…¥é¡¹ç›®ç›®å½•
cd huobao-drama
```

### 3.2 å®‰è£…åç«¯ä¾èµ–

```bash
# ä¸‹è½½ Go æ¨¡å—
go mod download

# éªŒè¯ä¾èµ–
 go mod verify

# æ•´ç† go.mod
go mod tidy
```

**ä¸­å›½å¤§é™†ç”¨æˆ·ï¼ˆä½¿ç”¨ä»£ç†åŠ é€Ÿï¼‰ï¼š**
```bash
# è®¾ç½® Go ä»£ç†
export GOPROXY=https://goproxy.cn,direct

# ç„¶åå†ä¸‹è½½ä¾èµ–
go mod download
```

### 3.3 å®‰è£…å‰ç«¯ä¾èµ–

```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd web

# å®‰è£…ä¾èµ–
pnpm install

# æˆ–ä½¿ç”¨ npm
npm install

# è¿”å›é¡¹ç›®æ ¹ç›®å½•
cd ..
```

### 3.4 éªŒè¯å®‰è£…æˆåŠŸçš„å‘½ä»¤

```bash
# 1. éªŒè¯ Go ç¯å¢ƒ
go version
go env GOPATH

# 2. éªŒè¯ Node.js ç¯å¢ƒ
node --version
pnpm --version

# 3. éªŒè¯ FFmpeg
ffmpeg -version

# 4. éªŒè¯é¡¹ç›®ä¾èµ–
ls -la go.mod go.sum
ls -la web/node_modules

# 5. ç¼–è¯‘æ£€æŸ¥
go build -o /dev/null .
```

---

## 4. ç¯å¢ƒå˜é‡é…ç½®

### 4.1 å¼€å‘ç¯å¢ƒ .env.local ç¤ºä¾‹

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env.local`ï¼š

```bash
# åº”ç”¨é…ç½®
APP_DEBUG=true
APP_ENV=development
GIN_MODE=debug

# æœåŠ¡å™¨é…ç½®
SERVER_PORT=5678
SERVER_HOST=0.0.0.0

# æ•°æ®åº“é…ç½®
DB_TYPE=sqlite
DB_PATH=./data/drama_generator.db

# å­˜å‚¨é…ç½®
STORAGE_TYPE=local
STORAGE_LOCAL_PATH=./data/storage
STORAGE_BASE_URL=http://localhost:5678/static

# AI æœåŠ¡é…ç½®ï¼ˆåœ¨ Web UI ä¸­é…ç½®å…·ä½“ API Keyï¼‰
AI_DEFAULT_TEXT_PROVIDER=openai
AI_DEFAULT_IMAGE_PROVIDER=openai
AI_DEFAULT_VIDEO_PROVIDER=doubao

# æ—¥å¿—é…ç½®
LOG_LEVEL=debug
```

### 4.2 configs/config.yaml å¼€å‘é…ç½®ç¤ºä¾‹

```yaml
app:
  name: "Huobao Drama API"
  version: "1.0.0"
  debug: true
  language: "zh"

server:
  port: 5678
  host: "0.0.0.0"
  cors_origins:
    - "http://localhost:3012"
    - "http://127.0.0.1:3012"
  read_timeout: 600
  write_timeout: 600

database:
  type: "sqlite"
  path: "./data/drama_generator.db"
  max_idle: 10
  max_open: 100

storage:
  type: "local"
  local_path: "./data/storage"
  base_url: "http://localhost:5678/static"

ai:
  default_text_provider: "openai"
  default_image_provider: "openai"
  default_video_provider: "doubao"

style:
  default_style: "realistic"
  default_role_style: "realistic"
  default_scene_style: "realistic"
  default_video_ratio: "9:16"
  default_image_ratio: "9:16"
  default_image_size: "1080x1920"
  default_prop_ratio: "1:1"
  default_prop_style: "realistic"
  default_scene_ratio: "16:9"
  default_role_ratio: "3:4"
```

### 4.3 æ•°æ®åº“è·¯å¾„é…ç½®

```yaml
database:
  type: "sqlite"
  path: "./data/drama_generator.db"  # SQLite æ•°æ®åº“æ–‡ä»¶è·¯å¾„
  max_idle: 10
  max_open: 100
```

**æ³¨æ„äº‹é¡¹ï¼š**
- æ•°æ®åº“ç›®å½• `data/` éœ€è¦å…·æœ‰è¯»å†™æƒé™
- SQLite ä½¿ç”¨ WAL æ¨¡å¼ä¼˜åŒ–å¹¶å‘æ€§èƒ½
- é¦–æ¬¡å¯åŠ¨ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®åº“æ–‡ä»¶å’Œè¡¨ç»“æ„

### 4.4 å­˜å‚¨è·¯å¾„é…ç½®

```yaml
storage:
  type: "local"
  local_path: "./data/storage"  # æœ¬åœ°å­˜å‚¨è·¯å¾„
  base_url: "http://localhost:5678/static"  # è®¿é—® URL å‰ç¼€
```

**å­˜å‚¨ç›®å½•ç»“æ„ï¼š**
```
data/storage/
â”œâ”€â”€ images/          # åœºæ™¯ã€åˆ†é•œå›¾ç‰‡
â”œâ”€â”€ characters/      # è§’è‰²å›¾ç‰‡
â”œâ”€â”€ videos/          # ç”Ÿæˆçš„è§†é¢‘
â”œâ”€â”€ uploads/         # ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶
â””â”€â”€ temp/            # ä¸´æ—¶æ–‡ä»¶
```

---

## 5. éªŒè¯å®‰è£…

### 5.1 è¿è¡Œåç«¯æœåŠ¡

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
go run main.go

# æˆ–ä½¿ç”¨ air çƒ­é‡è½½ï¼ˆéœ€è¦å®‰è£… airï¼‰
air
```

**é¢„æœŸè¾“å‡ºï¼š**
```
2026-02-04T10:30:00.000+0800    INFO    logger/logger.go:42     Starting Drama Generator API Server...
2026-02-04T10:30:00.001+0800    INFO    logger/logger.go:42     Database connected successfully
2026-02-04T10:30:00.002+0800    INFO    logger/logger.go:42     Database tables migrated successfully
2026-02-04T10:30:00.003+0800    INFO    logger/logger.go:42     Local storage initialized successfully    {"path": "./data/storage"}
2026-02-04T10:30:00.004+0800    INFO    logger/logger.go:42     ğŸš€ Server starting...
2026-02-04T10:30:00.005+0800    INFO    logger/logger.go:42     ğŸ“ Access URLs:
2026-02-04T10:30:00.006+0800    INFO    logger/logger.go:42        Frontend:  http://localhost:5678
2026-02-04T10:30:00.007+0800    INFO    logger/logger.go:42        API:       http://localhost:5678/api/v1
2026-02-04T10:30:00.008+0800    INFO    logger/logger.go:42        Health:    http://localhost:5678/health
2026-02-04T10:30:00.009+0800    INFO    logger/logger.go:42     âœ… Server is ready!
```

### 5.2 è¿è¡Œå‰ç«¯æœåŠ¡

```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd web

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev

# æˆ–
npm run dev
```

**é¢„æœŸè¾“å‡ºï¼š**
```
  VITE v5.x.x  ready in 500 ms

  âœ  Local:   http://localhost:3012/
  âœ  Network: http://192.168.x.x:3012/
  âœ  press h + enter to show help
```

### 5.3 è®¿é—®æœåŠ¡éªŒè¯

1. **å‰ç«¯ç•Œé¢ï¼š** http://localhost:3012
   - åº”æ˜¾ç¤ºç«å®çŸ­å‰§ Web ç•Œé¢
   - å·¦ä¸‹è§’æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯

2. **åç«¯ APIï¼š** http://localhost:5678/api/v1
   - æµ‹è¯•å¥åº·æ£€æŸ¥ï¼šhttp://localhost:5678/health
   - åº”è¿”å›ï¼š`{"status":"ok","app":"Huobao Drama API","version":"1.0.0"}`

3. **é™æ€æ–‡ä»¶ï¼š** http://localhost:5678/static
   - ä¸Šä¼ çš„å›¾ç‰‡åº”å¯é€šè¿‡æ­¤è·¯å¾„è®¿é—®

### 5.4 å¸¸è§é—®é¢˜æ’æŸ¥

#### é—®é¢˜1ï¼šç«¯å£å ç”¨

**ç—‡çŠ¶ï¼š**
```
bind: address already in use
```

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹ï¼ˆLinux/macOSï¼‰
lsof -i :5678
kill -9 <PID>

# Windows
netstat -ano | findstr :5678
taskkill /PID <PID> /F

# æˆ–ä¿®æ”¹é…ç½®æ–‡ä»¶ä½¿ç”¨å…¶ä»–ç«¯å£
# configs/config.yaml ä¸­ä¿®æ”¹ server.port
```

#### é—®é¢˜2ï¼šFFmpeg æœªæ‰¾åˆ°

**ç—‡çŠ¶ï¼š**
```
exec: "ffmpeg": executable file not found in %PATH%
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®è®¤ FFmpeg å·²æ­£ç¡®å®‰è£…ï¼š`ffmpeg -version`
2. æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦é…ç½®æ­£ç¡®
3. Windows ç”¨æˆ·é‡å¯ç»ˆç«¯æˆ–ç”µè„‘

#### é—®é¢˜3ï¼šæ•°æ®åº“æƒé™é”™è¯¯

**ç—‡çŠ¶ï¼š**
```
attempt to write a readonly database
```

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# Linux/macOS
chmod 755 ./data
chmod 644 ./data/drama_generator.db

# Windows å³é”® â†’ å±æ€§ â†’ å®‰å…¨ â†’ ç¼–è¾‘æƒé™
```

#### é—®é¢˜4ï¼šå‰ç«¯æ— æ³•è¿æ¥åç«¯

**ç—‡çŠ¶ï¼š**
```
Proxy error: Could not proxy request /api/v1/...
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®è®¤åç«¯æœåŠ¡å·²å¯åŠ¨ï¼ˆç«¯å£ 5678ï¼‰
2. æ£€æŸ¥ `web/vite.config.ts` ä¸­çš„ä»£ç†é…ç½®ï¼š

```typescript
server: {
  proxy: {
    '/api': {
      target: 'http://localhost:5678',
      changeOrigin: true
    }
  }
}
```

#### é—®é¢˜5ï¼šä¾èµ–ä¸‹è½½å¤±è´¥

**ç—‡çŠ¶ï¼š**
```
dial tcp: lookup proxy.golang.org: no such host
```

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# è®¾ç½® Go ä»£ç†ï¼ˆä¸­å›½å¤§é™†ï¼‰
export GOPROXY=https://goproxy.cn,direct

# è®¾ç½® npm é•œåƒï¼ˆä¸­å›½å¤§é™†ï¼‰
npm config set registry https://registry.npmmirror.com/
pnpm config set registry https://registry.npmmirror.com/
```

#### é—®é¢˜6ï¼šç¼–è¯‘é”™è¯¯

**ç—‡çŠ¶ï¼š**
```
undefined: SomeType
```

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ¸…ç†å¹¶é‡æ–°ä¸‹è½½ä¾èµ–
go clean -cache
go mod download

# æ•´ç† go.mod
go mod tidy

# é‡æ–°ç¼–è¯‘
go build .
```

---

## ä¸‹ä¸€æ­¥

ç¯å¢ƒæ­å»ºå®Œæˆåï¼Œè¯·å‚è€ƒï¼š
- [02-ä»£ç è§„èŒƒ.md](./02-ä»£ç è§„èŒƒ.md) - äº†è§£é¡¹ç›®ä»£ç è§„èŒƒ
- [03-DDDå¼€å‘æŒ‡å—.md](./03-DDDå¼€å‘æŒ‡å—.md) - å­¦ä¹  DDD å¼€å‘æ¨¡å¼
- [04-APIå¼€å‘æŒ‡å—.md](./04-APIå¼€å‘æŒ‡å—.md) - å­¦ä¹  API å¼€å‘æµç¨‹
