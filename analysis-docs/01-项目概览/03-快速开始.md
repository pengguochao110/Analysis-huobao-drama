# 03-快速开始

## 环境准备

### 系统要求

| 软件 | 版本 | 说明 |
|------|------|------|
| **Go** | 1.23+ | 后端运行时 |
| **Node.js** | 18+ | 前端构建环境 |
| **pnpm** | 9+ | 包管理器（推荐） |
| **FFmpeg** | 4.0+ | 视频处理（**必需**） |
| **SQLite** | 3.x | 数据库（内置） |

### 安装 FFmpeg

**macOS:**
```bash
brew install ffmpeg
```

**Ubuntu/Debian:**
```bash
sudo apt update
sudo apt install ffmpeg
```

**Windows:**
从 [FFmpeg 官网](https://ffmpeg.org/download.html) 下载并配置环境变量

验证安装：
```bash
ffmpeg -version
```

---

## 安装步骤

### 1. 克隆项目

```bash
git clone https://github.com/chatfire-AI/huobao-drama.git
cd huobao-drama
```

### 2. 安装后端依赖

```bash
go mod download
```

### 3. 安装前端依赖

```bash
cd web
pnpm install
cd ..
```

### 4. 配置应用

复制配置文件模板：

```bash
cp configs/config.example.yaml configs/config.yaml
```

编辑 `configs/config.yaml`：

```yaml
app:
  name: "Huobao Drama API"
  version: "1.0.0"
  debug: true  # 开发环境设为 true

server:
  port: 5678
  host: "0.0.0.0"
  cors_origins:
    - "http://localhost:3012"
  read_timeout: 600
  write_timeout: 600

database:
  type: "sqlite"
  path: "./data/drama_generator.db"
  max_idle: 10
  max_open: 100

storage:
  type: "local"
  local_path: "./data/storage"
  base_url: "http://localhost:5678/static"

ai:
  default_text_provider: "openai"
  default_image_provider: "openai"
  default_video_provider: "doubao"
```

**关键配置项：**
- `app.debug`: 调试模式开关
- `server.port`: 服务端口
- `server.cors_origins`: 前端跨域配置
- `database.path`: 数据库文件路径
- `storage.local_path`: 文件存储路径
- `ai.default_*_provider`: AI服务提供商

---

## 启动项目

### 方式1：开发模式（推荐）

**前端后端分离，支持热重载**

**终端 1 - 启动后端：**
```bash
go run main.go
```

**终端 2 - 启动前端：**
```bash
cd web
pnpm dev
```

**访问地址：**
- 前端：`http://localhost:3012`
- 后端API：`http://localhost:5678/api/v1`

### 方式2：单服务模式

**后端同时提供API和前端静态文件**

```bash
# 1. 构建前端
cd web
pnpm build
cd ..

# 2. 启动服务
go run main.go
```

**访问地址：**
- 完整应用：`http://localhost:5678`

---

## 数据库初始化

数据库表会在首次启动时自动创建（使用 GORM AutoMigrate），无需手动执行迁移。

如需手动执行迁移：
```bash
go run cmd/migrate/main.go
```

---

## 配置 AI 服务

### 1. 获取 API Key

- **OpenAI**: https://platform.openai.com/api-keys
- **豆包**: https://console.volcengine.com/
- **其他服务商**: 对应平台获取

### 2. 在 Web UI 配置

1. 打开前端页面
2. 进入"设置" → "AI服务配置"
3. 添加服务商和API Key
4. 测试连接

### 3. 配置示例

```
提供商: OpenAI
API Key: sk-xxxxxxxxxxxx
基础URL: https://api.openai.com/v1
模型: gpt-4, dall-e-3
```

---

## 验证安装

### 检查后端运行

```bash
curl http://localhost:5678/health
```

预期响应：
```json
{
  "status": "ok",
  "version": "1.0.0"
}
```

### 检查前端运行

浏览器访问 `http://localhost:3012`，应看到项目列表页面。

---

## 常见问题

### Q: FFmpeg 未找到
**A:** 确保 FFmpeg 已安装并在 PATH 中：
```bash
ffmpeg -version
```

### Q: 前端无法连接后端
**A:** 检查 CORS 配置，确保前端地址在 `cors_origins` 列表中。

### Q: 数据库锁定错误
**A:** SQLite 并发限制，确保只有一个进程写入数据库。检查是否同时运行多个实例。

### Q: AI 服务调用失败
**A:** 
- 检查 API Key 是否正确
- 检查网络连接
- 查看后端日志了解详细错误

---

## 下一步

1. [创建第一个短剧项目](../02-架构设计/05-核心工作流.md)
2. [配置 AI 服务商](../04-开发指南/数据清洗服务.md)
3. [了解系统架构](../02-架构设计/01-系统架构总览.md)

---

*更多部署方式请参考：*
- [Docker 部署](../02-架构设计/01-系统架构总览.md)
- [生产环境配置](../03-需求分析/non-functional/非功能需求说明书.md)
